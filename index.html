<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Total S.A.S - Sistema de Gestión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="p-8">
    <div id="app" class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-8 mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">Control Total S.A.S</h1>
            <p class="text-blue-200">Sistema de Análisis de Inversión y Gestión de Servicios</p>
        </div>

        <!-- Formulario de Entrada -->
        <div id="inputSection">
            <div class="glass rounded-2xl p-8 border border-white/20 mb-6">
                <div class="flex items-center space-x-3 mb-6">
                    <svg class="text-yellow-400" width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h2 class="text-2xl font-bold text-white">Ingreso de Variables de Entrada</h2>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">Datos Financieros</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-blue-200 mb-2">Inversión Inicial ($)</label>
                                <input type="number" id="inversionInicial" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 100000">
                            </div>
                            <div>
                                <label class="block text-blue-200 mb-2">Tasa de Descuento (%)</label>
                                <input type="number" step="0.1" id="tasaDescuento" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 10">
                            </div>
                            <div>
                                <label class="block text-blue-200 mb-2">Activos Corrientes ($)</label>
                                <input type="number" id="activosCorrientes" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 75000">
                            </div>
                            <div>
                                <label class="block text-blue-200 mb-2">Pasivos Corrientes ($)</label>
                                <input type="number" id="pasivosCorrientes" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 25000">
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-blue-200 mb-2">Ingresos Proyectados por Mes (12 valores separados por comas)</label>
                        <input type="text" id="ingresosProyectados" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 15000,15000,15000,15000,15000,15000,15000,15000,15000,15000,15000,15000">
                    </div>

                    <div>
                        <label class="block text-blue-200 mb-2">Costos Operativos por Mes (12 valores separados por comas)</label>
                        <input type="text" id="costosOperativos" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 8000,8000,8000,8000,8000,8000,8000,8000,8000,8000,8000,8000">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-blue-200 mb-2">Personal Disponible (empleados)</label>
                            <input type="number" id="personalDisponible" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 15">
                        </div>
                        <div>
                            <label class="block text-blue-200 mb-2">Presupuesto Disponible ($)</label>
                            <input type="number" id="presupuestoDisponible" class="w-full bg-white/5 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-400" placeholder="Ej: 50000">
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass rounded-2xl p-8 border border-white/20 mb-6">
                <h3 class="text-xl font-bold text-white mb-4">Datos Históricos de Demanda</h3>
                <p class="text-blue-200 mb-4">Ingresa el número de clientes por horario para cada día</p>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-white">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left p-3">Día</th>
                                <th class="text-center p-3">6am-9am</th>
                                <th class="text-center p-3">9am-12pm</th>
                                <th class="text-center p-3">12pm-3pm</th>
                                <th class="text-center p-3">3pm-6pm</th>
                                <th class="text-center p-3">6pm-8pm</th>
                            </tr>
                        </thead>
                        <tbody id="demandaTable">
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Lunes</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Martes</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Miércoles</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Jueves</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Viernes</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Sábado</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                            <tr class="border-b border-white/10">
                                <td class="p-3 font-semibold">Domingo</td>
                                <td class="text-center p-3"><input type="number" class="demanda-h1 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h2 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h3 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h4 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                                <td class="text-center p-3"><input type="number" class="demanda-h5 w-20 bg-white/5 border border-white/20 rounded px-2 py-1 text-center text-white" placeholder="0"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <button onclick="procesarDatos()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all shadow-lg">
                Procesar Datos y Generar Análisis
            </button>
        </div>

        <!-- Sección de Resultados -->
        <div id="resultsSection" style="display: none;">
            <div class="glass rounded-2xl p-8 mb-8 border border-white/20">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-4xl font-bold text-white mb-2">Control Total S.A.S</h1>
                        <p class="text-blue-200">Resultados del Análisis</p>
                    </div>
                    <button onclick="volverInput()" class="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-lg transition-all">
                        Modificar Datos
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex space-x-2 mb-8 glass rounded-xl p-2 border border-white/10">
                <button onclick="cambiarTab('financial')" id="tabFinancial" class="flex items-center space-x-2 px-6 py-3 rounded-lg transition-all bg-blue-500 text-white shadow-lg">
                    <span>Análisis Financiero</span>
                </button>
                <button onclick="cambiarTab('demand')" id="tabDemand" class="flex items-center space-x-2 px-6 py-3 rounded-lg transition-all text-blue-200 hover:bg-white/10">
                    <span>Predicción de Demanda</span>
                </button>
                <button onclick="cambiarTab('resources')" id="tabResources" class="flex items-center space-x-2 px-6 py-3 rounded-lg transition-all text-blue-200 hover:bg-white/10">
                    <span>Optimización de Recursos</span>
                </button>
                <button onclick="cambiarTab('report')" id="tabReport" class="flex items-center space-x-2 px-6 py-3 rounded-lg transition-all text-blue-200 hover:bg-white/10">
                    <span>Reporte Final</span>
                </button>
            </div>

            <!-- Contenido de los Tabs -->
            <div id="contentFinancial" class="tab-content">
                <div class="space-y-6" id="financialCardsContainer">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">ROI Calculado</h3>
                            <p id="roiValue" class="text-4xl font-bold text-white">0%</p>
                            <p class="text-green-100 text-sm mt-2">Retorno sobre Inversión</p>
                        </div>

                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">VAN Calculado</h3>
                            <p id="vanValue" class="text-4xl font-bold text-white">$0</p>
                            <p class="text-blue-100 text-sm mt-2">Valor Actual Neto</p>
                        </div>

                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">TIR Calculada</h3>
                            <p id="tirValue" class="text-4xl font-bold text-white">0%</p>
                            <p class="text-purple-100 text-sm mt-2">Tasa Interna de Retorno</p>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">Razón de Liquidez</h3>
                            <p id="liquidezValue" class="text-4xl font-bold text-white">0</p>
                            <p class="text-yellow-100 text-sm mt-2">Activos Corrientes / Pasivos Corrientes</p>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">Tasa de Endeudamiento</h3>
                            <p id="endeudamientoValue" class="text-4xl font-bold text-white">0%</p>
                            <p class="text-red-100 text-sm mt-2">Pasivos Corrientes / Activos Corrientes</p>
                        </div>


                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-2xl font-bold text-white mb-6">Flujo de Caja Proyectado</h3>
                        <canvas id="flujoCajaChart" height="100"></canvas>
                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-2xl font-bold text-white mb-6">Gráfico del Modelo de Optimización Lineal</h3>
                        <canvas id="optimizacionLinealChart" height="100"></canvas>
                        <div class="mt-4 text-center text-blue-200">
                            <p><span class="font-bold text-green-400">Ganancia Bruta (F)</span> = 469.566 * e^(0.144x)</p>
                            <p><span class="font-bold text-red-400">Costo Total (C)</span> = 310x</p>
                            <p><span class="font-bold text-blue-400">Ganancia Neta (G)</span> = F - C</p>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-2xl font-bold text-white mb-6">Tabla de Simulación de Ganancia Neta</h3>
                        <div class="overflow-y-auto max-h-96">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="text-center p-3">Técnicos Pico (X)</th>
                                        <th class="text-center p-3">Ganancia Bruta (F)</th>
                                        <th class="text-center p-3">Costo Total (C)</th>
                                        <th class="text-center p-3">Ganancia Neta (G)</th>
                                    </tr>
                                </thead>
                                <tbody id="optimizacionTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="contentDemand" class="tab-content" style="display: none;">
                <div class="space-y-6">
                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-2xl font-bold text-white mb-6">Comparación: Demanda Histórica vs Predicha</h3>
                        <canvas id="demandaChart" height="100"></canvas>
                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-xl font-bold text-white mb-4">Matriz de Demanda por Horario</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="text-left p-3">Día</th>
                                        <th class="text-center p-3">6am-9am</th>
                                        <th class="text-center p-3">9am-12pm</th>
                                        <th class="text-center p-3">12pm-3pm</th>
                                        <th class="text-center p-3">3pm-6pm</th>
                                        <th class="text-center p-3">6pm-8pm</th>
                                        <th class="text-center p-3">Total Predicho</th>
                                    </tr>
                                </thead>
                                <tbody id="demandaPredictedTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="contentResources" class="tab-content" style="display: none;">
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">Personal Disponible</h3>
                            <p id="personalValue" class="text-4xl font-bold text-white">0</p>
                            <p class="text-cyan-100 text-sm mt-2">Empleados totales</p>
                        </div>

                        <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 shadow-xl">
                            <h3 class="text-white font-semibold mb-2">Presupuesto Disponible</h3>
                            <p id="presupuestoValue" class="text-4xl font-bold text-white">$0</p>
                            <p class="text-emerald-100 text-sm mt-2">Para recursos</p>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-2xl font-bold text-white mb-6">Plan de Optimización de Recursos</h3>
                        <p class="text-blue-200 mb-4">Asignación Óptima de Personal por Horario</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="text-left p-3">Día</th>
                                        <th class="text-center p-3">6am-9am</th>
                                        <th class="text-center p-3">9am-12pm</th>
                                        <th class="text-center p-3">12pm-3pm</th>
                                        <th class="text-center p-3">3pm-6pm</th>
                                        <th class="text-center p-3">6pm-8pm</th>
                                        <th class="text-center p-3">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="asignacionTable"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-6 border border-white/20">
                        <h3 class="text-xl font-bold text-white mb-4">Distribución de Personal</h3>
                        <canvas id="personalChart" height="80"></canvas>
                    </div>
                </div>
            </div>

            <div id="contentReport" class="tab-content" style="display: none;">
                <div class="space-y-6">
                    <div class="glass rounded-2xl p-8 border border-white/20">
                        <h2 class="text-3xl font-bold text-white mb-6">Reporte Financiero y de Viabilidad</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white/5 rounded-xl p-6">
                                <p class="text-blue-200 text-sm mb-2">ROI Calculado</p>
                                <p id="reportRoi" class="text-4xl font-bold text-green-400">0%</p>
                            </div>
                            <div class="bg-white/5 rounded-xl p-6">
                                <p class="text-blue-200 text-sm mb-2">VAN Calculado</p>
                                <p id="reportVan" class="text-4xl font-bold text-blue-400">$0</p>
                            </div>
                            <div class="bg-white/5 rounded-xl p-6">
                                <p class="text-blue-200 text-sm mb-2">TIR Calculada</p>
                                <p id="reportTir" class="text-4xl font-bold text-purple-400">0%</p>
                            </div>
                            <div class="bg-white/5 rounded-xl p-6">
                                <p class="text-blue-200 text-sm mb-2">Razón de Liquidez</p>
                                <p id="reportLiquidez" class="text-4xl font-bold text-yellow-400">0</p>
                            </div>
                            <div class="bg-white/5 rounded-xl p-6">
                                <p class="text-blue-200 text-sm mb-2">Tasa de Endeudamiento</p>
                                <p id="reportEndeudamiento" class="text-4xl font-bold text-red-400">0%</p>
                            </div>
                        </div>
                        
                        <div class="bg-white/5 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Análisis de Resultados</h3>
                            <div id="reportAnalysis" class="space-y-3 text-blue-100"></div>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-8 border border-white/20">
                        <h2 class="text-3xl font-bold text-white mb-6">Gráfico de Demanda</h2>
                        <p class="text-blue-200 mb-4">Comparación entre demanda histórica y predicha por machine learning</p>
                        <canvas id="demandaReportChart" height="80"></canvas>
                        
                        <div class="bg-white/5 rounded-xl p-6 mt-6">
                            <h3 class="text-xl font-bold text-white mb-4">Insights de Demanda</h3>
                            <div class="space-y-3 text-blue-100">
                                <p>• Se aplicó un modelo de machine learning simplificado para predicción.</p>
                                <p>• Se predice un incremento del 8% en horarios de mañana y 12% en tarde.</p>
                                <p>• Los horarios de noche tienen un crecimiento estimado del 5%.</p>
                                <p id="totalClientes">• Total de clientes predichos: 0</p>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-8 border border-white/20">
                        <h2 class="text-3xl font-bold text-white mb-6">Plan de Optimización de Recursos</h2>
                        <p id="reportPersonal" class="text-blue-200 mb-6">Distribución óptima de empleados según demanda predicha</p>
                        
                        <div class="overflow-x-auto mb-6">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="text-left p-3">Día</th>
                                        <th class="text-center p-3">6am-9am</th>
                                        <th class="text-center p-3">9am-12pm</th>
                                        <th class="text-center p-3">12pm-3pm</th>
                                        <th class="text-center p-3">3pm-6pm</th>
                                        <th class="text-center p-3">6pm-8pm</th>
                                    </tr>
                                </thead>
                                <tbody id="reportAsignacionTable"></tbody>
                            </table>
                        </div>

                        <div class="bg-white/5 rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Recomendaciones Operativas</h3>
                            <div class="space-y-3 text-blue-100">
                                <p>• Asignar más personal en horarios de mayor demanda predicha.</p>
                                <p>• Optimizar recursos en días de menor afluencia para reducir costos.</p>
                                <p>• Implementar turnos rotativos para maximizar eficiencia.</p>
                                <p id="reportPresupuesto">• Presupuesto disponible para capacitación y recursos.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-green-500/20 to-blue-500/20 backdrop-blur-lg rounded-2xl p-8 border border-white/20">
                        <h2 class="text-3xl font-bold text-white mb-4">Conclusiones</h2>
                        <div id="reportConclusiones" class="space-y-4 text-blue-100 text-lg"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let charts = {};
        let datosGlobales = {};

        // Función Calcular_ROI
        function calcularROI(inversion, ingresos, costos) {
            const ingresoTotal = ingresos.reduce((a, b) => a + b, 0);
            const costoTotal = costos.reduce((a, b) => a + b, 0);
            const ganancia = ingresoTotal - costoTotal - inversion;
            const roi = (ganancia / inversion) * 100;
            return roi.toFixed(2);
        }

        // Función Calcular_VAN
        function calcularVAN(inversion, ingresos, costos, tasa) {
            let van = -inversion;
            
            for (let i = 0; i < ingresos.length; i++) {
                const flujoNeto = ingresos[i] - costos[i];
                van += flujoNeto / Math.pow(1 + tasa, i + 1);
            }
            
            return van.toFixed(2);
        }

        // Función Calcular_TIR
        function calcularTIR(inversion, ingresos, costos) {
            const flujos = [-inversion];
            
            for (let i = 0; i < ingresos.length; i++) {
                flujos.push(ingresos[i] - costos[i]);
            }
            
            let tir = 0.10;
            for (let j = 0; j < 100; j++) {
                let van = 0;
                for (let i = 0; i < flujos.length; i++) {
                    van += flujos[i] / Math.pow(1 + tir, i);
                }
                if (Math.abs(van) < 1) break;
                tir += van > 0 ? 0.001 : -0.001;
            }
            
            return (tir * 100).toFixed(2);
        }

        // Función para calcular la razón de liquidez
        function calcularLiquidez(activosCorrientes, pasivosCorrientes) {
            if (pasivosCorrientes === 0) return Infinity;
            const ratio = activosCorrientes / pasivosCorrientes;
            return ratio.toFixed(2);
        }

        // Función para calcular la tasa de endeudamiento
        function calcularEndeudamiento(pasivosCorrientes, activosCorrientes) {
            if (activosCorrientes === 0) return 0;
            const ratio = (pasivosCorrientes / activosCorrientes) * 100;
            return ratio.toFixed(2);
        }

        // --- INICIO DE LÓGICA DE OPTIMIZACIÓN EXPONENCIAL ---

        /**
         * Calcula la ganancia bruta según el modelo exponencial.
         * F(x, y) = 469.566 * e^(0.1*X + 0.08*Y)
         * @param {number} x - Técnicos de hora pico.
         * @param {number} y - Técnicos de horario regular.
         * @returns {number} La ganancia bruta calculada.
         */
        function calcularGananciaExponencial(x, y) {
            return 469.566 * Math.exp(0.1 * x + 0.08 * y);
        }

        /**
         * Simula la ganancia neta para diferentes combinaciones de técnicos.
         * G(X,Y) = GananciaExponencial - CostoTotal
         * @param {number} maxTecnicos - Número máximo de técnicos a simular.
         * @param {number} costoPorTecnico - Costo unitario por técnico.
         * @returns {Array} Un array con los resultados de la simulación.
         */
        function generarCurvaFuncion(puntos = 100, xMax = 25) {
            const resultados = [];
            const costoPorTecnico = 200;

            for (let i = 0; i <= puntos; i++) {
                const x = (i / puntos) * xMax; // Genera puntos desde 0 hasta xMax
                const y = x * 0.55; // Mantenemos la relación para tener una función de una variable

                // F(x) = 469.566 * e^(0.1x + 0.08 * (0.55x)) = 469.566 * e^(0.144x)
                const gananciaBruta = 469.566 * Math.exp(0.144 * x);
                
                // C(x) = 200 * (x + 0.55x) = 200 * 1.55x = 310x
                const costoTotal = 310 * x;

                const gananciaNeta = gananciaBruta - costoTotal;

                resultados.push({
                    x: x,
                    gananciaBruta: gananciaBruta,
                    costoTotal: costoTotal,
                    gananciaNeta: gananciaNeta
                });
            }
            return resultados;
        }

        // Función de predicción polinómica para simular un modelo de machine learning.
        // Esta función toma un valor base y le aplica una curva de crecimiento.
        function predecirConPolinomio(valorBase, factorCrecimiento) {
            if (valorBase <= 0) return 0;
            // Modelo polinómico simple: f(x) = x * factor + 0.05 * x^0.8
            // Esto añade un crecimiento no lineal que se modera para valores más altos.
            const prediccion = valorBase * factorCrecimiento 
                             + 0.05 * Math.pow(valorBase, 0.8);
            return Math.round(prediccion);
        }

        // Función Predecir_Demanda
        function predecirDemanda(datosHistoricos) {
            return datosHistoricos.map(dia => ({
                ...dia,
                h1Predicha: predecirConPolinomio(parseFloat(dia.h1), 1.08), // 6-9
                h2Predicha: predecirConPolinomio(parseFloat(dia.h2), 1.12), // 9-12
                h3Predicha: predecirConPolinomio(parseFloat(dia.h3), 1.15), // 12-3
                h4Predicha: predecirConPolinomio(parseFloat(dia.h4), 1.10), // 3-6
                h5Predicha: predecirConPolinomio(parseFloat(dia.h5), 1.05)  // 6-8
            }));
        }

        // Función Asignar_Personal
        function asignarPersonal(demandaPred, personalTotal) {
            const demandaTotal = demandaPred.reduce((acc, dia) => 
                acc + dia.h1Predicha + dia.h2Predicha + dia.h3Predicha + dia.h4Predicha + dia.h5Predicha, 0
            );
            
            return demandaPred.map(dia => {
                const demandaDia = dia.h1Predicha + dia.h2Predicha + dia.h3Predicha + dia.h4Predicha + dia.h5Predicha;
                const proporcion = demandaDia / demandaTotal;
                const personalDia = Math.round(personalTotal * proporcion * 7);
                
                return {
                    dia: dia.dia,
                    h1: Math.max(1, Math.round(personalDia * (dia.h1Predicha / demandaDia))),
                    h2: Math.max(1, Math.round(personalDia * (dia.h2Predicha / demandaDia))),
                    h3: Math.max(1, Math.round(personalDia * (dia.h3Predicha / demandaDia))),
                    h4: Math.max(1, Math.round(personalDia * (dia.h4Predicha / demandaDia))),
                    h5: Math.max(1, Math.round(personalDia * (dia.h5Predicha / demandaDia)))
                };
            });
        }

        function procesarDatos() {
            // Obtener valores
            const inversionInicial = document.getElementById('inversionInicial').value;
            const tasaDescuento = document.getElementById('tasaDescuento').value;
            const ingresosProyectados = document.getElementById('ingresosProyectados').value;
            const costosOperativos = document.getElementById('costosOperativos').value;
            const personalDisponible = document.getElementById('personalDisponible').value;
            const presupuestoDisponible = document.getElementById('presupuestoDisponible').value;
            const activosCorrientes = document.getElementById('activosCorrientes').value;
            const pasivosCorrientes = document.getElementById('pasivosCorrientes').value;

            // Validar campos básicos
            if (!inversionInicial || !tasaDescuento || !personalDisponible || !presupuestoDisponible || !activosCorrientes || !pasivosCorrientes) {
                alert('Por favor completa todos los campos financieros');
                return;
            }

            // Convertir ingresos y costos
            const ingresos = ingresosProyectados.split(',').map(v => parseFloat(v.trim()));
            const costos = costosOperativos.split(',').map(v => parseFloat(v.trim()));

            if (ingresos.length !== 12 || costos.length !== 12 || ingresos.some(isNaN) || costos.some(isNaN)) {
                alert('Debes ingresar exactamente 12 valores numéricos para ingresos y costos (uno por mes)');
                return;
            }

            // Obtener demanda histórica
            const dias = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
            const demandaH1 = document.querySelectorAll('.demanda-h1');
            const demandaH2 = document.querySelectorAll('.demanda-h2');
            const demandaH3 = document.querySelectorAll('.demanda-h3');
            const demandaH4 = document.querySelectorAll('.demanda-h4');
            const demandaH5 = document.querySelectorAll('.demanda-h5');

            const demandaHistorica = [];
            for (let i = 0; i < 7; i++) {
                const h1 = parseFloat(demandaH1[i].value);
                const h2 = parseFloat(demandaH2[i].value);
                const h3 = parseFloat(demandaH3[i].value);
                const h4 = parseFloat(demandaH4[i].value);
                const h5 = parseFloat(demandaH5[i].value);

                if (isNaN(h1) || isNaN(h2) || isNaN(h3) || isNaN(h4) || isNaN(h5)) {
                    alert('Por favor completa todos los datos de demanda histórica');
                    return;
                }

                demandaHistorica.push({ dia: dias[i], h1, h2, h3, h4, h5 });
            }

            // Calcular indicadores financieros
            const inversion = parseFloat(inversionInicial);
            const tasa = parseFloat(tasaDescuento) / 100;
            
            const roi = calcularROI(inversion, ingresos, costos);
            const van = calcularVAN(inversion, ingresos, costos, tasa);
            const tir = calcularTIR(inversion, ingresos, costos);

            // Calcular nuevos indicadores
            const activosC = parseFloat(activosCorrientes);
            const pasivosC = parseFloat(pasivosCorrientes);
            const liquidez = calcularLiquidez(activosC, pasivosC);
            const endeudamiento = calcularEndeudamiento(pasivosC, activosC);

            // Predecir demanda
            const demandaPredicha = predecirDemanda(demandaHistorica);

            // Asignar personal
            const asignacionOptima = asignarPersonal(demandaPredicha, parseFloat(personalDisponible));

            // Guardar datos globales
            datosGlobales = {
                inversionInicial: inversion,
                tasaDescuento: parseFloat(tasaDescuento),
                ingresos: ingresos,
                costos: costos,
                personalDisponible: parseFloat(personalDisponible),
                presupuestoDisponible: parseFloat(presupuestoDisponible),
                roi: roi,
                van: van,
                tir: tir,
                activosCorrientes: activosC,
                pasivosCorrientes: pasivosC,
                liquidez: liquidez,
                endeudamiento: endeudamiento,
                demandaHistorica: demandaHistorica,
                demandaPredicha: demandaPredicha,
                asignacionOptima: asignacionOptima
            };

            // Mostrar resultados
            mostrarResultados();
        }

        function mostrarResultados() {
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';

            // Actualizar valores
            document.getElementById('roiValue').textContent = datosGlobales.roi + '%';
            document.getElementById('vanValue').textContent = `$${parseFloat(datosGlobales.van).toLocaleString()}`; // Corregido
            document.getElementById('tirValue').textContent = datosGlobales.tir + '%';
            document.getElementById('personalValue').textContent = datosGlobales.personalDisponible;
            document.getElementById('presupuestoValue').textContent = `$${datosGlobales.presupuestoDisponible.toLocaleString()}`; // Corregido
            document.getElementById('liquidezValue').textContent = datosGlobales.liquidez;
            document.getElementById('endeudamientoValue').textContent = datosGlobales.endeudamiento + '%';

            // Crear gráficos
            crearGraficoFlujoCaja();
            crearGraficoDemanda();
            crearGraficoOptimizacionLineal();
            crearGraficoPersonal();
            llenarTablaDemanda();
            llenarTablaAsignacion();
            llenarTablaOptimizacion(); // Nueva función
            llenarReporte();
        }

        function crearGraficoFlujoCaja() {
            const ctx = document.getElementById('flujoCajaChart');
            if (charts.flujoCaja) charts.flujoCaja.destroy();

            const meses = Array.from({length: 12}, (_, i) => `Mes ${i + 1}`);
            const flujoNeto = datosGlobales.ingresos.map((ing, i) => ing - datosGlobales.costos[i]);

            charts.flujoCaja = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Ingresos',
                            data: datosGlobales.ingresos,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Costos',
                            data: datosGlobales.costos,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Flujo Neto',
                            data: flujoNeto,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function crearGraficoOptimizacionLineal() {
            const ctx = document.getElementById('optimizacionLinealChart');
            if (charts.optimizacion) charts.optimizacion.destroy();

            // Realizamos la simulación con el modelo exponencial
            const simulacion = generarCurvaFuncion(100, 25); // Generamos 100 puntos hasta X=25

            charts.optimizacion = new Chart(ctx, {
                type: 'scatter', // Cambiamos a 'scatter' para un eje X numérico
                data: {
                    datasets: [
                        {
                            label: 'Ganancia Bruta (F)',
                            data: simulacion.map(s => ({x: s.x, y: s.gananciaBruta})), // Usamos formato {x, y}
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            showLine: true // Conectamos los puntos para ver la curva
                        },
                        {
                            label: 'Costo Total (C)',
                            data: simulacion.map(s => ({x: s.x, y: s.costoTotal})),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            showLine: true
                        },
                        {
                            label: 'Ganancia Neta (G)',
                            data: simulacion.map(s => ({x: s.x, y: s.gananciaNeta})),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            borderWidth: 3,
                            showLine: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#fff' } },
                        tooltip: {
                            callbacks: {
                                label: (context) => `Técnicos Pico (X): ${context.parsed.x}, Monto: $${context.parsed.y.toFixed(2)}`
                            }
                        }
                    },
                    scales: {
                        x: { 
                            type: 'linear', 
                            position: 'bottom', 
                            title: { display: true, text: 'Técnicos de Hora Pico (X)', font: { size: 14 }, color: '#fff' }, 
                            ticks: { color: '#fff' }, 
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            min: 0, // Empezamos desde 0 para ver toda la historia
                            max: 25   // Y a terminar donde se ve la acción
                        },
                        y: { 
                            title: { display: true, text: 'Monto ($)', font: { size: 14 }, color: '#fff' }, 
                            ticks: { color: '#fff' }, 
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            beginAtZero: false // ¡ESTE ES EL CAMBIO CLAVE!
                        }
                    }
                }
            });
        }

        function crearGraficoDemanda() {

            const ctx = document.getElementById('demandaChart');
            if (charts.demanda) charts.demanda.destroy();

            const dias = datosGlobales.demandaPredicha.map(d => d.dia);

            charts.demanda = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dias,
                    datasets: [
                        {
                            label: '6-9 (Hist)',
                            data: datosGlobales.demandaHistorica.map(d => d.h1),
                            backgroundColor: '#fbbf24'
                        },
                        {
                            label: '6-9 (Pred)',
                            data: datosGlobales.demandaPredicha.map(d => d.h1Predicha),
                            backgroundColor: '#f59e0b'
                        },
                        {
                            label: '9-12 (Hist)',
                            data: datosGlobales.demandaHistorica.map(d => d.h2),
                            backgroundColor: '#3b82f6'
                        },
                        {
                            label: '9-12 (Pred)',
                            data: datosGlobales.demandaPredicha.map(d => d.h2Predicha),
                            backgroundColor: '#2563eb'
                        },
                        {
                            label: '12-3 (Hist)',
                            data: datosGlobales.demandaHistorica.map(d => d.h3),
                            backgroundColor: '#8b5cf6'
                        },
                        {
                            label: '12-3 (Pred)',
                            data: datosGlobales.demandaPredicha.map(d => d.h3Predicha),
                            backgroundColor: '#7c3aed'
                        },
                        {
                            label: '3-6 (Hist)',
                            data: datosGlobales.demandaHistorica.map(d => d.h4),
                            backgroundColor: '#10b981'
                        },
                        {
                            label: '6-8 (Hist)',
                            data: datosGlobales.demandaHistorica.map(d => d.h5),
                            backgroundColor: '#ef4444'
                        },
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // Crear gráfico para reporte
            const ctx2 = document.getElementById('demandaReportChart');
            if (charts.demandaReport) charts.demandaReport.destroy();

            charts.demandaReport = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: dias,
                    datasets: [
                        {
                            label: 'Demanda Histórica (12pm-3pm)',
                            data: datosGlobales.demandaHistorica.map(d => d.h3),
                            backgroundColor: '#3b82f6'
                        },
                        {
                            label: 'Demanda Predicha (12pm-3pm)',
                            data: datosGlobales.demandaPredicha.map(d => d.h3Predicha),
                            backgroundColor: '#10b981'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function crearGraficoPersonal() {
            const ctx = document.getElementById('personalChart');
            if (charts.personal) charts.personal.destroy();

            const dias = datosGlobales.asignacionOptima.map(d => d.dia);

            charts.personal = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dias,
                    datasets: [
                        {
                            label: '6am-9am',
                            data: datosGlobales.asignacionOptima.map(d => d.h1),
                            backgroundColor: '#fbbf24'
                        },
                        {
                            label: '9am-12pm',
                            data: datosGlobales.asignacionOptima.map(d => d.h2),
                            backgroundColor: '#3b82f6'
                        },
                        {
                            label: '12pm-3pm',
                            data: datosGlobales.asignacionOptima.map(d => d.h3),
                            backgroundColor: '#8b5cf6'
                        },
                        {
                            label: '3pm-6pm',
                            data: datosGlobales.asignacionOptima.map(d => d.h4),
                            backgroundColor: '#10b981'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            stacked: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function llenarTablaOptimizacion() {
            const tbody = document.getElementById('optimizacionTableBody');
            tbody.innerHTML = '';
            // Generamos los mismos datos que el gráfico para la tabla
            const simulacion = generarCurvaFuncion(25, 25).filter(p => p.x >= 8 && p.x % 2 === 0);
            simulacion.forEach(s => {
                const esPositivo = s.gananciaNeta > 0;
                const colorClass = esPositivo ? 'text-green-400' : 'text-red-400';
                const row = `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="text-center p-3">${s.x}</td>
                        <td class="text-center p-3">$${s.gananciaBruta.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                        <td class="text-center p-3">$${s.costoTotal.toLocaleString()}</td>
                        <td class="text-center p-3 font-bold ${colorClass}">$${s.gananciaNeta.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function llenarTablaDemanda() {
            const tbody = document.getElementById('demandaPredictedTable');
            tbody.innerHTML = '';

            datosGlobales.demandaPredicha.forEach(dia => {
                const total = dia.h1Predicha + dia.h2Predicha + dia.h3Predicha + dia.h4Predicha + dia.h5Predicha;
                const row = `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="p-3 font-semibold">${dia.dia}</td>
                        <td class="text-center p-3">${dia.h1Predicha}</td>
                        <td class="text-center p-3">${dia.h2Predicha}</td>
                        <td class="text-center p-3">${dia.h3Predicha}</td>
                        <td class="text-center p-3">${dia.h4Predicha}</td>
                        <td class="text-center p-3">${dia.h5Predicha}</td>
                        <td class="text-center p-3 font-bold text-blue-300">${total}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function llenarTablaAsignacion() {
            const tbody = document.getElementById('asignacionTable');
            tbody.innerHTML = '';

            datosGlobales.asignacionOptima.forEach(dia => {
                const total = dia.h1 + dia.h2 + dia.h3 + dia.h4 + dia.h5;
                const row = `
                    <tr class="border-b border-white/10 hover:bg-white/5">
                        <td class="p-3 font-semibold">${dia.dia}</td>
                        <td class="text-center p-3">
                            <span class="bg-yellow-500/20 px-3 py-1 rounded-full">${dia.h1} empleados</span>
                        </td>
                        <td class="text-center p-3">
                            <span class="bg-blue-500/20 px-3 py-1 rounded-full">${dia.h2} empleados</span>
                        </td>
                        <td class="text-center p-3">
                            <span class="bg-purple-500/20 px-3 py-1 rounded-full">${dia.h3} empleados</span>
                        </td>
                        <td class="text-center p-3">
                            <span class="bg-green-500/20 px-3 py-1 rounded-full">${dia.h4} empleados</span>
                        </td>
                        <td class="text-center p-3 font-bold text-green-300">${total}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Llenar tabla de reporte
            const tbody2 = document.getElementById('reportAsignacionTable');
            tbody2.innerHTML = '';

            datosGlobales.asignacionOptima.forEach(dia => {
                const row = `
                    <tr class="border-b border-white/10">
                        <td class="p-3 font-semibold">${dia.dia}</td>
                        <td class="text-center p-3">${dia.h1} empleados</td>
                        <td class="text-center p-3">${dia.h2} empleados</td>
                        <td class="text-center p-3">${dia.h3} empleados</td>
                        <td class="text-center p-3">${dia.h4} empleados</td>
                        <td class="text-center p-3">${dia.h5} empleados</td>
                    </tr>
                `;
                tbody2.innerHTML += row;
            });
        }

        function llenarReporte() {
            // Valores del reporte
            document.getElementById('reportRoi').textContent = datosGlobales.roi + '%';
            document.getElementById('reportVan').textContent = `$${parseFloat(datosGlobales.van).toLocaleString()}`; // Corregido
            document.getElementById('reportTir').textContent = datosGlobales.tir + '%';
            document.getElementById('reportLiquidez').textContent = datosGlobales.liquidez;
            document.getElementById('reportEndeudamiento').textContent = datosGlobales.endeudamiento + '%';

            // Análisis
            const ingresoTotal = datosGlobales.ingresos.reduce((a, b) => a + b, 0);
            const analisis = document.getElementById('reportAnalysis');
            analisis.innerHTML = `
                <p>• La inversión de $${datosGlobales.inversionInicial.toLocaleString()} genera un ROI de ${datosGlobales.roi}%.</p>
                <p>• La razón de liquidez es de ${datosGlobales.liquidez}, lo que indica que la empresa ${datosGlobales.liquidez >= 1 ? 'puede cubrir sus deudas a corto plazo' : 'podría tener dificultades para cubrir sus deudas a corto plazo'}.</p>
                <p>• La tasa de endeudamiento a corto plazo es del ${datosGlobales.endeudamiento}%, mostrando la proporción de activos financiada por deuda.</p>
                <p>• El VAN es de $${parseFloat(datosGlobales.van).toLocaleString()}, indicando ${parseFloat(datosGlobales.van) > 0 ? 'que el proyecto agrega valor' : 'que requiere ajustes'}.</p>
                <p>• La TIR de ${datosGlobales.tir}% ${parseFloat(datosGlobales.tir) > datosGlobales.tasaDescuento ? 'supera' : 'está por debajo de'} la tasa de descuento del ${datosGlobales.tasaDescuento}%.</p>
                <p>• Los ingresos proyectados totales son de $${ingresoTotal.toLocaleString()} en 12 meses.</p>
            `;

            // Total clientes
            const totalClientes = datosGlobales.demandaPredicha.reduce((acc, dia) => 
                acc + dia.h1Predicha + dia.h2Predicha + dia.h3Predicha + dia.h4Predicha + dia.h5Predicha, 0
            );
            document.getElementById('totalClientes').textContent = `• Total de clientes predichos: ${totalClientes}`;

            // Personal
            document.getElementById('reportPersonal').textContent = `Distribución óptima de ${datosGlobales.personalDisponible} empleados según demanda predicha`;
            document.getElementById('reportPresupuesto').textContent = `• Presupuesto disponible: $${datosGlobales.presupuestoDisponible.toLocaleString()} para capacitación y recursos.`;

            // Conclusiones
            const conclusiones = document.getElementById('reportConclusiones');
            conclusiones.innerHTML = `
                <p>✓ El sistema integra exitosamente el análisis financiero con la gestión operativa.</p>
                <p>✓ La predicción de demanda permite anticipar picos de atención y ajustar recursos.</p>
                <p>✓ La optimización de personal reduce costos innecesarios y maximiza eficiencia.</p>
                <p>✓ Los indicadores ROI (${datosGlobales.roi}%), VAN ($${parseFloat(datosGlobales.van).toLocaleString()}) y TIR (${datosGlobales.tir}%) confirman viabilidad financiera.</p>
                <p>✓ La implementación fortalece la rentabilidad y sostenibilidad de Control Total S.A.S.</p>
            `;
        }

        function cambiarTab(tab) {
            // Ocultar todos los contenidos
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            
            // Remover clase activa de todos los tabs
            document.querySelectorAll('[id^="tab"]').forEach(el => {
                el.classList.remove('bg-blue-500', 'text-white', 'shadow-lg');
                el.classList.add('text-blue-200', 'hover:bg-white/10');
            });

            // Mostrar contenido seleccionado
            document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1)).style.display = 'block';
            
            // Activar tab seleccionado
            const activeTab = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1));
            activeTab.classList.add('bg-blue-500', 'text-white', 'shadow-lg');
            activeTab.classList.remove('text-blue-200', 'hover:bg-white/10');
        }

        function volverInput() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('inputSection').style.display = 'block';
        }
    </script>
</body>
</html>